var t={id:"updateRanks",handler:({},{database:t,logger:E})=>{t.raw("BEGIN; \t\tSELECT  FROM public.municipalities  \t\t\t\t\tORDER BY id \t\t\t\t\tFOR UPDATE; \t\t\t\tWITH RankedScores AS ( \t\t\t\t\t\tSELECT \t\t\t\t\t\tid, \t\t\t\t\t\tDENSE_RANK() OVER (ORDER BY score_total DESC) AS place \t\t\t\t\t\tFROM \t\t\t\t\t\tpublic.municipalities \t\t\t\t\t\tWHERE status='published' \t\t\t\t\t) \t\t\t\tUPDATE public.municipalities AS m \t\t\t\t\t\tSET place = ( \t\t\t\t\t\t\tCASE \t\t\t\t\t\t\t\tWHEN m.status = 'published' THEN ( \t\t\t\t\t\t\t\t\tSELECT r.place \t\t\t\t\t\t\t\t\tFROM RankedScores r \t\t\t\t\t\t\t\t\tWHERE m.id = r.id \t\t\t\t\t\t\t\t) \t\t\t\t\t\t\t\tELSE -1 \t\t\t\t\t\t\tEND \t\t\t\t\t\t); \t\t\t\tCOMMIT;\t\t").then((t=>{})).catch((t=>{throw E.info(t,"error pushing DB"),t}))}};export{t as default};
