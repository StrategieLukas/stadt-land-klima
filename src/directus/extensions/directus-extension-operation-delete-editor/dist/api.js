var e="object"==typeof global&&global&&global.Object===Object&&global,t="object"==typeof self&&self&&self.Object===Object&&self,r=e||t||Function("return this")(),o=r.Symbol,n=Object.prototype,c=n.hasOwnProperty,a=n.toString,i=o?o.toStringTag:void 0;var u=Object.prototype.toString;var l=o?o.toStringTag:void 0;function b(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":l&&l in Object(e)?function(e){var t=c.call(e,i),r=e[i];try{e[i]=void 0;var o=!0}catch(e){}var n=a.call(e);return o&&(t?e[i]=r:delete e[i]),n}(e):function(e){return u.call(e)}(e)}function s(e){return null!=e&&"object"==typeof e}var f=Array.isArray;function p(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function y(e){if(!p(e))return!1;var t=b(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var j,v=r["__core-js_shared__"],d=(j=/[^.]+$/.exec(v&&v.keys&&v.keys.IE_PROTO||""))?"Symbol(src)_1."+j:"";var g=Function.prototype.toString;function m(e){if(null!=e){try{return g.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var O=/^\[object .+?Constructor\]$/,h=Function.prototype,w=Object.prototype,A=h.toString,S=w.hasOwnProperty,x=RegExp("^"+A.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function P(e){return!(!p(e)||(t=e,d&&d in t))&&(y(e)?x:O).test(m(e));var t}function F(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return P(r)?r:void 0}var M=F(r,"WeakMap");function T(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}var U=Object.prototype;function k(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||U)}function E(e){return s(e)&&"[object Arguments]"==b(e)}var I=Object.prototype,_=I.hasOwnProperty,B=I.propertyIsEnumerable,$=E(function(){return arguments}())?E:function(e){return s(e)&&_.call(e,"callee")&&!B.call(e,"callee")};var D="object"==typeof exports&&exports&&!exports.nodeType&&exports,N=D&&"object"==typeof module&&module&&!module.nodeType&&module,R=N&&N.exports===D?r.Buffer:void 0,V=(R?R.isBuffer:void 0)||function(){return!1},W={};W["[object Float32Array]"]=W["[object Float64Array]"]=W["[object Int8Array]"]=W["[object Int16Array]"]=W["[object Int32Array]"]=W["[object Uint8Array]"]=W["[object Uint8ClampedArray]"]=W["[object Uint16Array]"]=W["[object Uint32Array]"]=!0,W["[object Arguments]"]=W["[object Array]"]=W["[object ArrayBuffer]"]=W["[object Boolean]"]=W["[object DataView]"]=W["[object Date]"]=W["[object Error]"]=W["[object Function]"]=W["[object Map]"]=W["[object Number]"]=W["[object Object]"]=W["[object RegExp]"]=W["[object Set]"]=W["[object String]"]=W["[object WeakMap]"]=!1;var q,C="object"==typeof exports&&exports&&!exports.nodeType&&exports,z=C&&"object"==typeof module&&module&&!module.nodeType&&module,G=z&&z.exports===C&&e.process,K=function(){try{var e=z&&z.require&&z.require("util").types;return e||G&&G.binding&&G.binding("util")}catch(e){}}(),H=K&&K.isTypedArray,J=H?(q=H,function(e){return q(e)}):function(e){return s(e)&&T(e.length)&&!!W[b(e)]};var L=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Q=Object.prototype.hasOwnProperty;var X=F(r,"Map"),Y=F(r,"DataView"),Z=F(r,"Promise"),ee=F(r,"Set"),te="[object Map]",re="[object Promise]",oe="[object Set]",ne="[object WeakMap]",ce="[object DataView]",ae=m(Y),ie=m(X),ue=m(Z),le=m(ee),be=m(M),se=b;(Y&&se(new Y(new ArrayBuffer(1)))!=ce||X&&se(new X)!=te||Z&&se(Z.resolve())!=re||ee&&se(new ee)!=oe||M&&se(new M)!=ne)&&(se=function(e){var t=b(e),r="[object Object]"==t?e.constructor:void 0,o=r?m(r):"";if(o)switch(o){case ae:return ce;case ie:return te;case ue:return re;case le:return oe;case be:return ne}return t});var fe=se,pe=Object.prototype.hasOwnProperty;function ye(e){if(null==e)return!0;if(function(e){return null!=e&&T(e.length)&&!y(e)}(e)&&(f(e)||"string"==typeof e||"function"==typeof e.splice||V(e)||J(e)||$(e)))return!e.length;var t=fe(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(k(e))return!function(e){if(!k(e))return L(e);var t=[];for(var r in Object(e))Q.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e).length;for(var r in e)if(pe.call(e,r))return!1;return!0}var je={id:"delete-editor",handler:async({keys:e,measureIds:t},{env:r,logger:o,accountability:n,services:c,getSchema:a})=>{if(ye(Array.isArray(e)?e:[e]))throw new Error("No Keys for deletion");n.admin=!0;const{UsersService:i,ItemsService:u}=c,l=await a(),b=new i({schema:l,accountability:n}),s=new u("editors",{schema:l,accountability:n});let f=await s.readMany(e,{limit:-1});o.info("editors:");let p=[];for(const e of f){o.info(e);let t=await b.getUserByEmail(e.email);ye(t)?o.info("User not found"):p.push(t.id)}ye(p)||b.deleteMany(p)}};export{je as default};
