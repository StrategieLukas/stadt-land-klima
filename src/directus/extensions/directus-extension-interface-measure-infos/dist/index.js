import{resolveComponent as e,openBlock as t,createElementBlock as a,createVNode as n,createElementVNode as r,toDisplayString as i,Fragment as s,renderList as o,createCommentVNode as d}from"vue";var l=[],c=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",r=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(r){var s=l.indexOf(i);-1===s&&(s=l.push(i)-1,c[s]={}),a=c[s]&&c[s][n]?c[s][n]:c[s][n]=o()}else a=o();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function o(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),r=0;r<a.length;r++)e.setAttribute(a[r],t.attributes[a[r]]);var s="prepend"===n?"afterbegin":"beforeend";return i.insertAdjacentElement(s,e),e}}("\n.measure-preview[data-v-38ee1ccf] {\n  --v-notice-padding: 12px 16px;\n}\n.measure-content[data-v-38ee1ccf] {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n.field-preview[data-v-38ee1ccf] {\n  background-color: var(--theme--background-subdued);\n  border: 1px solid var(--theme--border-color-subdued);\n  border-radius: var(--theme--border-radius);\n  padding: 12px 16px;\n  transition: border-color var(--fast) var(--transition);\n}\n.field-preview[data-v-38ee1ccf]:hover {\n  border-color: var(--theme--border-color);\n}\n.field-header[data-v-38ee1ccf] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 8px;\n  color: var(--theme--foreground-subdued);\n}\n.field-header .v-icon[data-v-38ee1ccf] {\n  --v-icon-color: var(--theme--primary);\n}\n.field-label[data-v-38ee1ccf] {\n  font-weight: 600;\n  font-size: 18px;\n  color: var(--theme--foreground);\n}\n.field-content[data-v-38ee1ccf] {\n  color: var(--theme--foreground);\n  font-size: 16px;\n  line-height: 1.6;\n}\n.field-content.empty[data-v-38ee1ccf] {\n  color: var(--theme--foreground-subdued);\n  font-style: italic;\n}\n.field-content[data-v-38ee1ccf] p {\n  margin: 0 0 8px 0;\n}\n.field-content[data-v-38ee1ccf] p:last-child {\n  margin-bottom: 0;\n}\n.field-content[data-v-38ee1ccf] ul,\n.field-content[data-v-38ee1ccf] ol {\n  margin: 8px 0;\n  padding-left: 20px;\n}\n.field-content[data-v-38ee1ccf] li {\n  margin-bottom: 4px;\n}\n.loading-container[data-v-38ee1ccf] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 16px;\n  color: var(--theme--foreground-subdued);\n}\n.loading-text[data-v-38ee1ccf] {\n  font-size: 14px;\n}\n.v-notice[data-v-38ee1ccf] {\n  --v-notice-margin: 0;\n}\n.measure-link[data-v-38ee1ccf] {\n  margin-top: 16px;\n}\n.measure-link a[data-v-38ee1ccf] {\n  color: var(--theme--primary);\n  text-decoration: underline;\n  font-weight: 500;\n}\n",{});const u={class:"measure-preview"},f={key:0,class:"v-notice info"},m={class:"content"},p={class:"title"},v={key:1,class:"loading-container"},h={class:"loading-text"},g={key:2,class:"v-notice danger"},y={class:"content"},_={class:"title"},b={class:"text"},x={key:3,class:"measure-content"},w={class:"field-header"},k={class:"field-label"},D=["innerHTML"],$={key:1,class:"field-content empty"},I={key:0,class:"measure-link"},T=["href"],M={key:4,class:"v-notice warning"},j={class:"content"},F={class:"title"};var S={id:"measure-preview",name:"Measure Preview",icon:"info",description:"Displays selected measure fields inline in ratings_measures",component:((e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a})({name:"MeasurePreview",inject:["api"],props:{value:{default:null},field:{type:String,required:!0},collection:{type:String,required:!0},primaryKey:{type:[String,Number],default:null},measure_field:{type:String,default:"measure_id"},fields_to_display:{type:Array,default:()=>["description_about","description_evaluation_criteria","description_verification"]}},data:()=>({measureId:null,measureData:{},loading:!1,error:null,fieldsToDisplay:[],currentItem:null}),computed:{measureField(){return this.measure_field||"measure_id"}},watch:{primaryKey:{immediate:!0,handler(e){e&&this.fetchCurrentItem()}}},mounted(){this.fieldsToDisplay=this.fields_to_display,this.primaryKey&&this.fetchCurrentItem()},methods:{async fetchCurrentItem(){const e=this.primaryKey||this.value;if(e&&this.api)try{const t=await this.api.get(`/items/${this.collection}/${e}`);this.currentItem=t.data.data;const a=this.currentItem[this.measureField];a&&(this.measureId=a,this.fetchMeasure(a))}catch(e){console.error("[MeasurePreview] Error fetching current item:",e)}},async fetchMeasure(e){if(e&&this.api){this.loading=!0,this.error=null;try{const t=await this.api.get(`/items/measures/${e}`,{params:{fields:[...this.fieldsToDisplay,"sector","slug"].join(",")}});t.data&&t.data.data?this.measureData=t.data.data:this.measureData=t.data||{}}catch(e){console.error("[MeasurePreview] Error fetching measure:",e),this.error=e.message||this.$t("failed_to_fetch_measure_data"),this.measureData={}}finally{this.loading=!1}}},getFieldLabel(e){const t=`ratings_measures.fields.${e}`,a=this.$t(t);return a&&a!==t?a:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}}},[["render",function(l,c,S,C,A,E){const O=e("v-icon"),K=e("v-progress-circular");return t(),a("div",u,[A.measureId?A.loading?(t(),a("div",v,[n(K,{indeterminate:""}),r("span",h,i(l.$t("loading_measure_data")),1)])):A.error?(t(),a("div",g,[n(O,{name:"error"}),r("div",y,[r("div",_,i(l.$t("error")),1),r("div",b,i(A.error),1)])])):A.measureData&&Object.keys(A.measureData).length>0?(t(),a("div",x,[(t(!0),a(s,null,o(A.fieldsToDisplay,e=>(t(),a("div",{key:e,class:"field-preview"},[r("div",w,[n(O,{name:"info",small:""}),r("span",k,i(E.getFieldLabel(e)),1)]),A.measureData[e]?(t(),a("div",{key:0,class:"field-content",innerHTML:A.measureData[e]},null,8,D)):(t(),a("div",$,i(l.$t("no_content_available")),1))]))),128)),d(" frontend link "),A.measureData.slug&&A.measureData.sector?(t(),a("div",I,[r("a",{href:`https://stadt-land-klima.de/measures/sectors/${A.measureData.sector}#measure-${A.measureData.slug}`,target:"_blank",rel:"noopener noreferrer"},i(l.$t("view_measure_on_frontend")),9,T)])):d("v-if",!0)])):(t(),a("div",M,[n(O,{name:"warning"}),r("div",j,[r("div",F,i(l.$t("no_measure_data_available")),1)])])):(t(),a("div",f,[n(O,{name:"info"}),r("div",m,[r("div",p,i(l.$t("no_measure_selected")),1)])]))])}],["__scopeId","data-v-38ee1ccf"],["__file","interface.vue"]]),types:["string","integer","bigInteger","json","text"],localTypes:["standard"],group:"other",options:[{field:"measure_field",type:"string",name:"Measure Reference Field",meta:{width:"full",note:"Field in this collection that relates to measures",interface:"input"},schema:{default_value:"measure_id"}},{field:"fields_to_display",type:"json",name:"Fields to Display",meta:{width:"full",note:"Fields from the measure to display (as JSON array)",interface:"input-code",options:{language:"json"}},schema:{default_value:'["description_about","description_evaluation_criteria","description_verification"]'}}]};export{S as default};
