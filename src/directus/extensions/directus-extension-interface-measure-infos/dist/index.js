import{resolveComponent as e,openBlock as t,createElementBlock as a,createCommentVNode as n,createElementVNode as r,toDisplayString as i,createVNode as s,Fragment as d,renderList as l}from"vue";var o=[],u=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",r=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(r){var s=o.indexOf(i);-1===s&&(s=o.push(i)-1,u[s]={}),a=u[s]&&u[s][n]?u[s][n]:u[s][n]=d()}else a=d();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function d(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),r=0;r<a.length;r++)e.setAttribute(a[r],t.attributes[a[r]]);var s="prepend"===n?"afterbegin":"beforeend";return i.insertAdjacentElement(s,e),e}}("\n.measure-preview[data-v-9db80e15] {\n  --v-notice-padding: 12px 16px;\n}\n.measure-content[data-v-9db80e15] {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n}\n.field-preview[data-v-9db80e15] {\n  background-color: var(--theme--background-subdued);\n  border: 1px solid var(--theme--border-color-subdued);\n  border-radius: var(--theme--border-radius);\n  padding: 12px 16px;\n  transition: border-color var(--fast) var(--transition);\n}\n.field-preview[data-v-9db80e15]:hover {\n  border-color: var(--theme--border-color);\n}\n.field-header[data-v-9db80e15] {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 8px;\n  color: var(--theme--foreground-subdued);\n}\n.field-header .v-icon[data-v-9db80e15] {\n  --v-icon-color: var(--theme--primary);\n}\n.field-label[data-v-9db80e15] {\n  font-weight: 600;\n  font-size: 16px;\n  color: var(--theme--foreground);\n}\n.field-content[data-v-9db80e15] {\n  color: var(--theme--foreground);\n  font-size: 15px;\n  line-height: 1.6;\n}\n.field-content.empty[data-v-9db80e15] {\n  color: var(--theme--foreground-subdued);\n  font-style: italic;\n}\n.field-content[data-v-9db80e15] p {\n  margin: 0 0 8px 0;\n}\n.field-content[data-v-9db80e15] p:last-child {\n  margin-bottom: 0;\n}\n.field-content[data-v-9db80e15] ul,\n.field-content[data-v-9db80e15] ol {\n  margin: 8px 0;\n  padding-left: 20px;\n}\n.field-content[data-v-9db80e15] li {\n  margin-bottom: 4px;\n}\n.loading-container[data-v-9db80e15] {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 16px;\n  color: var(--theme--foreground-subdued);\n}\n.loading-text[data-v-9db80e15] {\n  font-size: 14px;\n}\n.v-notice[data-v-9db80e15] {\n  --v-notice-margin: 0;\n}\n.measure-link[data-v-9db80e15] {\n  margin-top: 16px;\n}\n.measure-link a[data-v-9db80e15] {\n  color: var(--theme--primary);\n  text-decoration: underline;\n  font-weight: 500;\n}\n",{});const c={class:"measure-preview"},m={key:0,class:"measure-link"},p=["href"],f={key:1,class:"v-notice info"},v={class:"content"},h={class:"title"},g={key:2,class:"loading-container"},b={class:"loading-text"},y={key:3,class:"v-notice danger"},_={class:"content"},x={class:"title"},w={class:"text"},D={key:4,class:"measure-content"},k={class:"field-header"},M={class:"field-label"},$=["innerHTML"],I={key:1,class:"field-content empty"},T={key:5,class:"v-notice warning"},L={class:"content"},F={class:"title"};var j={id:"measure-preview",name:"Measure Preview",icon:"info",description:"Displays selected measure fields inline in ratings_measures",component:((e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a})({name:"MeasurePreview",inject:["api"],props:{value:{default:null},field:{type:String,required:!0},collection:{type:String,required:!0},primaryKey:{type:[String,Number],default:null},measure_field:{type:String,default:"measure_id"},fields_to_display:{type:Array,default:()=>["description_about","description_evaluation_criteria","description_verification"]}},data:()=>({measureId:null,measureData:{},loading:!1,error:null,fieldsToDisplay:[],currentItem:null}),computed:{measureField(){return this.measure_field||"measure_id"}},watch:{primaryKey:{immediate:!0,handler(){this.ensureMeasureLoaded()}},value(e){this.ensureMeasureLoaded()},options:{deep:!0,handler(){this.ensureMeasureLoaded()}}},mounted(){this.fieldsToDisplay=this.fields_to_display,this.ensureMeasureLoaded()},methods:{async ensureMeasureLoaded(){const e=this.options&&this.options.measure_field||this.measure_field||"measure_id",t=this.primaryKey??null,a=this.value??null;if(t&&"+"!==t)if(this.field===e){const e=a||this.value||null;e?await this.fetchMeasure(e):(this.measureData={},this.measureId=null)}else try{const a=await this.api.get(`/items/${this.collection}/${t}`),n=(a?.data?.data||{})[e]??null;n?(this.measureId=n,await this.fetchMeasure(n)):(this.measureData={},this.measureId=null)}catch(e){console.error("[MeasurePreview] Error fetching parent item:",e),this.measureData={},this.measureId=null}else{if(this.field===e){const e=a||null;return void(e?(this.measureId=e,await this.fetchMeasure(e)):(this.measureData={},this.measureId=null))}this.measureData={},this.measureId=null}},async fetchMeasure(e){if(e&&this.api){this.loading=!0,this.error=null;try{const t=await this.api.get(`/items/measures/${e}`,{params:{fields:[...this.fieldsToDisplay,"sector","slug"].join(",")}});this.measureData=t?.data?.data||{}}catch(e){console.error("[MeasurePreview] Error fetching measure:",e),this.error=e?.message||"Failed to fetch measure",this.measureData={}}finally{this.loading=!1}}},getFieldLabel(e){const t=`ratings_measures.fields.${e}`,a=this.$t(t);return a&&a!==t?a:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}}},[["render",function(o,u,j,S,A,E){const O=e("v-icon"),N=e("v-progress-circular");return t(),a("div",c,[n(" Link to Frontend "),A.measureData.slug&&A.measureData.sector?(t(),a("div",m,[r("a",{href:`https://stadt-land-klima.de/measures/sectors/${A.measureData.sector}#measure-${A.measureData.slug}`,target:"_blank",rel:"noopener noreferrer"},i(o.$t("directus.fields.view_measure_on_frontend")),9,p)])):n("v-if",!0),A.measureId?A.loading?(t(),a("div",g,[s(N,{indeterminate:""}),r("span",b,i(o.$t("loading_measure_data")),1)])):A.error?(t(),a("div",y,[s(O,{name:"error"}),r("div",_,[r("div",x,i(o.$t("error")),1),r("div",w,i(A.error),1)])])):A.measureData&&Object.keys(A.measureData).length>0?(t(),a("div",D,[(t(!0),a(d,null,l(A.fieldsToDisplay,e=>(t(),a("div",{key:e,class:"field-preview"},[r("div",k,[s(O,{name:"info",small:""}),r("span",M,i(E.getFieldLabel(e)),1)]),A.measureData[e]?(t(),a("div",{key:0,class:"field-content",innerHTML:A.measureData[e]},null,8,$)):(t(),a("div",I,i(o.$t("no_content_available")),1))]))),128))])):(t(),a("div",T,[s(O,{name:"warning"}),r("div",L,[r("div",F,i(o.$t("no_measure_data_available")),1)])])):(t(),a("div",f,[s(O,{name:"info"}),r("div",v,[r("div",h,i(o.$t("no_measure_selected")),1)])]))])}],["__scopeId","data-v-9db80e15"],["__file","interface.vue"]]),types:["string","integer","bigInteger","json","text"],localTypes:["standard"],group:"other",options:[{field:"measure_field",type:"string",name:"Measure Reference Field",meta:{width:"full",note:"Field in this collection that relates to measures",interface:"input"},schema:{default_value:"measure_id"}},{field:"fields_to_display",type:"json",name:"Fields to Display",meta:{width:"full",note:"Fields from the measure to display (as JSON array)",interface:"input-code",options:{language:"json"}},schema:{default_value:'["description_about","description_evaluation_criteria","description_verification"]'}}]};export{j as default};
