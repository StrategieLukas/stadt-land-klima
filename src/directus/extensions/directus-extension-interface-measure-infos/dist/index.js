import{resolveComponent as e,openBlock as a,createElementBlock as t,createElementVNode as i,toDisplayString as r,createCommentVNode as s,createVNode as n,Fragment as d,renderList as o}from"vue";var l=[],c=[];!function(e,a){if(e&&"undefined"!=typeof document){var t,i=!0===a.prepend?"prepend":"append",r=!0===a.singleTag,s="string"==typeof a.container?document.querySelector(a.container):document.getElementsByTagName("head")[0];if(r){var n=l.indexOf(s);-1===n&&(n=l.push(s)-1,c[n]={}),t=c[n]&&c[n][i]?c[n][i]:c[n][i]=d()}else t=d();65279===e.charCodeAt(0)&&(e=e.substring(1)),t.styleSheet?t.styleSheet.cssText+=e:t.appendChild(document.createTextNode(e))}function d(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),a.attributes)for(var t=Object.keys(a.attributes),r=0;r<t.length;r++)e.setAttribute(t[r],a.attributes[t[r]]);var n="prepend"===i?"afterbegin":"beforeend";return s.insertAdjacentElement(n,e),e}}("\n.measure-preview[data-v-bcc89455] { --v-notice-padding: 12px 16px;\n}\n.measure-content[data-v-bcc89455] { display:flex; flex-direction:column; gap:16px;\n}\n.field-preview[data-v-bcc89455] { background-color:var(--theme--background-subdued); border:1px solid var(--theme--border-color-subdued); border-radius:var(--theme--border-radius); padding:12px 16px; transition:border-color var(--fast) var(--transition);\n}\n.field-preview[data-v-bcc89455]:hover { border-color:var(--theme--border-color);\n}\n.field-header[data-v-bcc89455] { display:flex; align-items:center; gap:8px; margin-bottom:8px; color:var(--theme--foreground-subdued);\n}\n.field-header .v-icon[data-v-bcc89455] { --v-icon-color:var(--theme--primary);\n}\n.field-label[data-v-bcc89455] { font-weight:600; font-size:16px; color:var(--theme--foreground);\n}\n.field-content[data-v-bcc89455] { color:var(--theme--foreground); font-size:15px; line-height:1.6;\n}\n.field-content.empty[data-v-bcc89455] { color:var(--theme--foreground-subdued); font-style:italic;\n}\n.field-content[data-v-bcc89455] p { margin:0 0 8px 0;\n}\n.field-content[data-v-bcc89455] p:last-child { margin-bottom:0;\n}\n.field-content[data-v-bcc89455] ul, .field-content[data-v-bcc89455] ol { margin:8px 0; padding-left:20px;\n}\n.field-content[data-v-bcc89455] li { margin-bottom:4px;\n}\n.loading-container[data-v-bcc89455] { display:flex; align-items:center; gap:12px; padding:16px; color:var(--theme--foreground-subdued);\n}\n.loading-text[data-v-bcc89455] { font-size:14px;\n}\n.v-notice[data-v-bcc89455] { --v-notice-margin:0;\n}\n.measure-link[data-v-bcc89455] { margin-top:4px; margin-bottom:8px;\n}\n.measure-link a[data-v-bcc89455] { color:var(--theme--primary); text-decoration:underline; font-weight:500;\n}\n.id-info[data-v-bcc89455] { font-size: 14px;\n}\n",{});const u={class:"measure-preview"},m={class:"id-info"},p={key:0,class:"measure-link"},f=["href"],h={key:1,class:"v-notice info"},v={class:"content"},g={class:"title"},b={key:2,class:"loading-container"},y={class:"loading-text"},_={key:3,class:"v-notice danger"},x={class:"content"},D={class:"title"},w={class:"text"},k={key:4,class:"measure-content"},M={class:"field-header"},$={class:"field-label"},I=["innerHTML"],T={key:1,class:"field-content empty"},L={key:5,class:"v-notice warning"},F={class:"content"},j={class:"title"};var S={id:"measure-preview",name:"Measure Preview",icon:"info",description:"Displays selected measure fields inline in ratings_measures",component:((e,a)=>{const t=e.__vccOpts||e;for(const[e,i]of a)t[e]=i;return t})({name:"MeasurePreview",inject:["api","$trans"],props:{value:{default:null},field:{type:String,required:!0},collection:{type:String,required:!0},primaryKey:{type:[String,Number],default:null},measure_field:{type:String,default:"measure_id"},fields_to_display:{type:Array,default:()=>["description_about","description_evaluation_criteria","description_verification"]}},data:()=>({measureId:null,measureData:{},loading:!1,error:null,fieldsToDisplay:[]}),computed:{measureField(){return this.measure_field||"measure_id"},hasMeasureData(){return this.measureData&&Object.keys(this.measureData).length>0}},watch:{primaryKey:{immediate:!0,handler(){this.ensureMeasureLoaded()}},value(){this.ensureMeasureLoaded()},options:{deep:!0,handler(){this.ensureMeasureLoaded()}}},mounted(){this.fieldsToDisplay=this.fields_to_display,this.ensureMeasureLoaded()},methods:{async ensureMeasureLoaded(){const e=this.options&&this.options.measure_field||this.measure_field||"measure_id",a=this.primaryKey??null,t=this.value??null;if(a&&"+"!==a)if(this.field===e){const e=t||this.value||null;e?await this.fetchMeasure(e):(this.measureData={},this.measureId=null)}else try{const t=await this.api.get(`/items/${this.collection}/${a}`),i=(t?.data?.data||{})[e]??null;i?(this.measureId=i,await this.fetchMeasure(i)):(this.measureData={},this.measureId=null)}catch(e){console.error("[MeasurePreview] Error fetching parent item:",e),this.measureData={},this.measureId=null}else{if(this.field===e){const e=t||null;return void(e?(this.measureId=e,await this.fetchMeasure(e)):(this.measureData={},this.measureId=null))}this.measureData={},this.measureId=null}},async fetchMeasure(e){if(e&&this.api){this.loading=!0,this.error=null;try{const a=await this.api.get(`/items/measures/${e}`,{params:{fields:[...this.fieldsToDisplay,"sector","slug","measure_id"].join(",")}});this.measureData=a?.data?.data||{}}catch(e){console.error("[MeasurePreview] Error fetching measure:",e),this.error=e?.message||"Failed to fetch measure",this.measureData={}}finally{this.loading=!1}}},getFieldLabel(e){const a=this.$t(`ratings_measures.fields.${e}`);return a&&a!==`ratings_measures.fields.${e}`?a:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}}},[["render",function(l,c,S,A,E,O){const z=e("v-icon"),N=e("v-progress-circular");return a(),t("div",u,[i("p",m,"ID: "+r(E.measureData.measure_id),1),s(" Link to Frontend "),E.measureData.slug&&E.measureData.sector?(a(),t("div",p,[i("a",{href:`https://stadt-land-klima.de/measures/sectors/${E.measureData.sector}#${E.measureData.measure_id}`,target:"_blank",rel:"noopener noreferrer"},r(l.$t("directus.fields.view_measure_on_frontend")),9,f)])):s("v-if",!0),E.measureId?E.loading?(a(),t("div",b,[n(N,{indeterminate:""}),i("span",y,r(l.$t("generic.loading")),1)])):E.error?(a(),t("div",_,[n(z,{name:"error"}),i("div",x,[i("div",D,r(l.$t("error")),1),i("div",w,r(E.error),1)])])):O.hasMeasureData?(a(),t("div",k,[(a(!0),t(d,null,o(E.fieldsToDisplay,e=>(a(),t("div",{key:e,class:"field-preview"},[i("div",M,[n(z,{name:"info",small:""}),i("span",$,r(O.getFieldLabel(e)),1)]),E.measureData[e]?(a(),t("div",{key:0,class:"field-content",innerHTML:E.measureData[e]},null,8,I)):(a(),t("div",T,r(l.$t("no_content_available")),1))]))),128))])):(a(),t("div",L,[n(z,{name:"warning"}),i("div",F,[i("div",j,r(l.$t("no_measure_data_available")),1)])])):(a(),t("div",h,[n(z,{name:"info"}),i("div",v,[i("div",g,r(l.$t("directus.interfaces.no_measure_found_error")),1)])]))])}],["__scopeId","data-v-bcc89455"],["__file","interface.vue"]]),types:["string","integer","bigInteger","json","text"],localTypes:["standard"],group:"other",options:[{field:"measure_field",type:"string",name:"Measure Reference Field",meta:{width:"full",note:"Field in this collection that relates to measures",interface:"input"},schema:{default_value:"measure_id"}},{field:"fields_to_display",type:"json",name:"Fields to Display",meta:{width:"full",note:"Fields from the measure to display (as JSON array)",interface:"input-code",options:{language:"json"}},schema:{default_value:'["description_about","description_evaluation_criteria","description_verification"]'}}]};export{S as default};
