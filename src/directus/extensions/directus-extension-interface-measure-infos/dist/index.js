import{resolveComponent as e,openBlock as t,createElementBlock as a,createCommentVNode as r,createElementVNode as i,toDisplayString as s,createVNode as n,Fragment as d,renderList as l}from"vue";var o=[],u=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,r=!0===t.prepend?"prepend":"append",i=!0===t.singleTag,s="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(i){var n=o.indexOf(s);-1===n&&(n=o.push(s)-1,u[n]={}),a=u[n]&&u[n][r]?u[n][r]:u[n][r]=d()}else a=d();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function d(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),i=0;i<a.length;i++)e.setAttribute(a[i],t.attributes[a[i]]);var n="prepend"===r?"afterbegin":"beforeend";return s.insertAdjacentElement(n,e),e}}("\n.measure-preview[data-v-89d965db] { --v-notice-padding: 12px 16px;\n}\n.measure-content[data-v-89d965db] { display:flex; flex-direction:column; gap:16px;\n}\n.field-preview[data-v-89d965db] { background-color:var(--theme--background-subdued); border:1px solid var(--theme--border-color-subdued); border-radius:var(--theme--border-radius); padding:12px 16px; transition:border-color var(--fast) var(--transition);\n}\n.field-preview[data-v-89d965db]:hover { border-color:var(--theme--border-color);\n}\n.field-header[data-v-89d965db] { display:flex; align-items:center; gap:8px; margin-bottom:8px; color:var(--theme--foreground-subdued);\n}\n.field-header .v-icon[data-v-89d965db] { --v-icon-color:var(--theme--primary);\n}\n.field-label[data-v-89d965db] { font-weight:600; font-size:16px; color:var(--theme--foreground);\n}\n.field-content[data-v-89d965db] { color:var(--theme--foreground); font-size:15px; line-height:1.6;\n}\n.field-content.empty[data-v-89d965db] { color:var(--theme--foreground-subdued); font-style:italic;\n}\n.field-content[data-v-89d965db] p { margin:0 0 8px 0;\n}\n.field-content[data-v-89d965db] p:last-child { margin-bottom:0;\n}\n.field-content[data-v-89d965db] ul, .field-content[data-v-89d965db] ol { margin:8px 0; padding-left:20px;\n}\n.field-content[data-v-89d965db] li { margin-bottom:4px;\n}\n.loading-container[data-v-89d965db] { display:flex; align-items:center; gap:12px; padding:16px; color:var(--theme--foreground-subdued);\n}\n.loading-text[data-v-89d965db] { font-size:14px;\n}\n.v-notice[data-v-89d965db] { --v-notice-margin:0;\n}\n.measure-link[data-v-89d965db] { margin-top:16px; margin-bottom:8px;\n}\n.measure-link a[data-v-89d965db] { color:var(--theme--primary); text-decoration:underline; font-weight:500;\n}\n",{});const c={class:"measure-preview"},m={key:0,class:"measure-link"},p=["href"],f={key:1,class:"v-notice info"},h={class:"content"},v={class:"title"},g={key:2,class:"loading-container"},b={class:"loading-text"},y={key:3,class:"v-notice danger"},_={class:"content"},x={class:"title"},w={class:"text"},D={key:4,class:"measure-content"},k={class:"field-header"},M={class:"field-label"},$=["innerHTML"],I={key:1,class:"field-content empty"},T={key:5,class:"v-notice warning"},L={class:"content"},F={class:"title"};var j={id:"measure-preview",name:"Measure Preview",icon:"info",description:"Displays selected measure fields inline in ratings_measures",component:((e,t)=>{const a=e.__vccOpts||e;for(const[e,r]of t)a[e]=r;return a})({name:"MeasurePreview",inject:["api","$trans"],props:{value:{default:null},field:{type:String,required:!0},collection:{type:String,required:!0},primaryKey:{type:[String,Number],default:null},measure_field:{type:String,default:"measure_id"},fields_to_display:{type:Array,default:()=>["description_about","description_evaluation_criteria","description_verification"]}},data:()=>({measureId:null,measureData:{},loading:!1,error:null,fieldsToDisplay:[]}),computed:{measureField(){return this.measure_field||"measure_id"},hasMeasureData(){return this.measureData&&Object.keys(this.measureData).length>0}},watch:{primaryKey:{immediate:!0,handler(){this.ensureMeasureLoaded()}},value(){this.ensureMeasureLoaded()},options:{deep:!0,handler(){this.ensureMeasureLoaded()}}},mounted(){this.fieldsToDisplay=this.fields_to_display,this.ensureMeasureLoaded()},methods:{async ensureMeasureLoaded(){const e=this.options&&this.options.measure_field||this.measure_field||"measure_id",t=this.primaryKey??null,a=this.value??null;if(t&&"+"!==t)if(this.field===e){const e=a||this.value||null;e?await this.fetchMeasure(e):(this.measureData={},this.measureId=null)}else try{const a=await this.api.get(`/items/${this.collection}/${t}`),r=(a?.data?.data||{})[e]??null;r?(this.measureId=r,await this.fetchMeasure(r)):(this.measureData={},this.measureId=null)}catch(e){console.error("[MeasurePreview] Error fetching parent item:",e),this.measureData={},this.measureId=null}else{if(this.field===e){const e=a||null;return void(e?(this.measureId=e,await this.fetchMeasure(e)):(this.measureData={},this.measureId=null))}this.measureData={},this.measureId=null}},async fetchMeasure(e){if(e&&this.api){this.loading=!0,this.error=null;try{const t=await this.api.get(`/items/measures/${e}`,{params:{fields:[...this.fieldsToDisplay,"sector","slug"].join(",")}});this.measureData=t?.data?.data||{}}catch(e){console.error("[MeasurePreview] Error fetching measure:",e),this.error=e?.message||"Failed to fetch measure",this.measureData={}}finally{this.loading=!1}}},getFieldLabel(e){const t=this.$t(`ratings_measures.fields.${e}`);return t&&t!==`ratings_measures.fields.${e}`?t:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}}},[["render",function(o,u,j,S,A,E){const O=e("v-icon"),N=e("v-progress-circular");return t(),a("div",c,[r(" Link to Frontend "),A.measureData.slug&&A.measureData.sector?(t(),a("div",m,[i("a",{href:`https://stadt-land-klima.de/measures/sectors/${A.measureData.sector}#measure-${A.measureData.slug}`,target:"_blank",rel:"noopener noreferrer"},s(o.$t("directus.fields.view_measure_on_frontend")),9,p)])):r("v-if",!0),A.measureId?A.loading?(t(),a("div",g,[n(N,{indeterminate:""}),i("span",b,s(o.$t("loading_measure_data")),1)])):A.error?(t(),a("div",y,[n(O,{name:"error"}),i("div",_,[i("div",x,s(o.$t("error")),1),i("div",w,s(A.error),1)])])):E.hasMeasureData?(t(),a("div",D,[(t(!0),a(d,null,l(A.fieldsToDisplay,e=>(t(),a("div",{key:e,class:"field-preview"},[i("div",k,[n(O,{name:"info",small:""}),i("span",M,s(E.getFieldLabel(e)),1)]),A.measureData[e]?(t(),a("div",{key:0,class:"field-content",innerHTML:A.measureData[e]},null,8,$)):(t(),a("div",I,s(o.$t("no_content_available")),1))]))),128))])):(t(),a("div",T,[n(O,{name:"warning"}),i("div",L,[i("div",F,s(o.$t("no_measure_data_available")),1)])])):(t(),a("div",f,[n(O,{name:"info"}),i("div",h,[i("div",v,s(o.$t("no_measure_selected")),1)])]))])}],["__scopeId","data-v-89d965db"],["__file","interface.vue"]]),types:["string","integer","bigInteger","json","text"],localTypes:["standard"],group:"other",options:[{field:"measure_field",type:"string",name:"Measure Reference Field",meta:{width:"full",note:"Field in this collection that relates to measures",interface:"input"},schema:{default_value:"measure_id"}},{field:"fields_to_display",type:"json",name:"Fields to Display",meta:{width:"full",note:"Fields from the measure to display (as JSON array)",interface:"input-code",options:{language:"json"}},schema:{default_value:'["description_about","description_evaluation_criteria","description_verification"]'}}]};export{j as default};
